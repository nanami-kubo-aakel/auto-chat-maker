# 機能要件

## 1. 機能一覧（画面ベース・非開発者向け）

| ID | 機能名 | 概要 | 主要な画面・操作 |
|---|---|---|---|
| F-001 | 自動返信提案機能 | Teamsチャットの新着メッセージを自動で検知し、AIが返信案を生成して提案 | 通知画面、返信案選択画面 |
| F-002 | 返信管理機能 | 生成された返信案の確認、選択、編集、送信 | 返信案一覧、編集画面、送信確認画面 |

### F-001 自動返信提案機能
- **概要**: Teamsチャットの新着メッセージを自動で検知し、AIが返信案を生成して提案
- **ユーザー体験**: 通知を受け取り、提案された返信案から選択または修正して送信
- **画面要素**: 通知画面、返信案選択画面、チャットUI

### F-002 返信管理機能
- **概要**: 生成された返信案の確認、選択、編集、送信
- **ユーザー体験**: 複数の返信案を比較し、最適なものを選択またはカスタマイズ
- **画面要素**: 返信案一覧、編集画面、送信確認画面

## 2. 機能要件（開発単位ベース・開発者向け）

| ID | 機能要件名 | 概要 | 技術要素 | 対応機能ID |
|---|---|---|---|---|
| R-001 | Teamsチャット検知 | Graph APIのwebhookを使った新着メッセージ検知 | Webhook処理、サブスクリプション管理 | F-001 |
| R-002 | MCP経由メッセージ取得 | MCPサーバーを通じたメッセージ情報取得 | MCPサーバー連携、メッセージ解析 | F-001 |
| R-003 | AI返信判断・案生成 | AI APIを使った返信判断と案生成 | AI API連携、自然言語処理 | F-001, F-002 |
| R-004 | ユーザー通知・UI表示 | 通知システムとUIコンポーネント | 通知システム、UIコンポーネント | F-001, F-002 |
| R-005 | MCP経由返信送信 | MCPサーバーを通じた返信送信 | 返信送信処理 | F-002 |
| R-006 | 拡張性機能 | 将来の機能拡張を考慮した基盤 | 共通インターフェース、プラグイン基盤 | F-001, F-002 |

### R-001 Teamsチャット検知
- **概要**: Graph API の `change notifications (webhook)` を使い、Teamsチャットの新着メッセージをリアルタイムに検知
- **技術要素**:
  - Webhook処理基盤
  - サブスクリプション管理（定期更新）
  - 将来的なメール対応を考慮した共通Webhook処理基盤
- **対応機能**: F-001

### R-002 MCP経由メッセージ取得
- **概要**: `ms-365-mcp-server` を通じて、対象チャットメッセージの本文・送信者・スレッド情報を取得
- **技術要素**:
  - MCPサーバー連携
  - メッセージタイプ識別（テキスト、画像、ファイル等）
  - 将来的なメール対応を考慮した共通メッセージ処理インターフェース
- **対応機能**: F-001

### R-003 AI返信判断・案生成
- **概要**: Claude APIなどと接続し、チャットメッセージに対して返信判断と案生成を実施
- **技術要素**:
  - AI API連携
  - 返信必要性判断ロジック
  - 3件程度の返信案生成
  - 文脈・トーン考慮した自然文生成
  - 将来的なメール対応時も同じAI判定・生成ロジックを再利用
- **対応機能**: F-001, F-002

### R-004 ユーザー通知・UI表示
- **概要**: ユーザーへの通知と返信案提示のためのUI
- **技術要素**:
  - 通知システム（Web/モバイル等）
  - 返信案提示UI（ボタンまたは一覧形式）
  - チャットUI（案選択・修正入力）
  - チャットとメールの統合管理を考慮したUI設計
- **対応機能**: F-001, F-002

### R-005 MCP経由返信送信
- **概要**: ユーザーが確定した返信内容をもとに、MCP経由で返信を送信
- **技術要素**:
  - MCP経由で `chat.reply` を実行
  - Teamsチャットへの返信処理
  - 将来的なメール対応時は `mail.reply` に拡張可能な設計
- **対応機能**: F-002

### R-006 拡張性機能（将来対応）
- **概要**: 将来の機能拡張を考慮した基盤機能
- **技術要素**:
  - メッセージ処理の共通インターフェース
  - プラグイン形式での新機能追加
  - 設定による機能の有効/無効切り替え
- **対応機能**: F-001, F-002

## 3. トレーサビリティマトリックス

| 機能ID | 機能名 | R-001 | R-002 | R-003 | R-004 | R-005 | R-006 |
|---|---|---|---|---|---|---|---|
| F-001 | 自動返信提案機能 | ✓ | ✓ | ✓ | ✓ | - | ✓ |
| F-002 | 返信管理機能 | - | - | ✓ | ✓ | ✓ | ✓ |

## 更新履歴

- 初版作成: 2024年12月
- Teams対応化: 2024年12月 - Teamsチャットベースに変更、拡張性機能を追加
- 機能整理・トレーサビリティ追加: 2024年12月 - 画面ベースと開発単位ベースに分類、ID付与
- 最終更新: 2024年12月
- 更新者: 開発チーム
