# ユースケース詳細仕様

## 1. 概要

このドキュメントでは、Auto Chat Makerシステムの各ユースケースについて、詳細な仕様をテーブル形式で定義します。システムはTeamsチャット対応を基本とし、将来的なOutlookメール対応も考慮した拡張性のある設計となっています。

## 2. ユースケース仕様テーブル

### 2.1 UC-001: Teamsチャット自動検知・返信案生成

| 項目 | 内容 |
|------|------|
| **ユースケース名** | Teamsチャット自動検知・返信案生成 |
| **ユースケースID** | UC-001 |
| **優先度** | 高 |
| **アクター** | エンドユーザー、Microsoft Graph API、AIサービス |
| **前提条件** | システムが正常に動作している、Webhookサブスクリプションが有効 |
| **事後条件** | 返信案が生成され、ユーザーに通知される |
| **基本フロー** | 1. Webhook通知受信 → 2. チャットメッセージ情報取得 → 3. AI判定 → 4. 返信案生成 → 5. ユーザー通知 |
| **代替フロー** | A1: 返信不要判定、A2: チャットメッセージ取得失敗、A3: AIサービス障害 |
| **例外処理** | E1: Webhook期限切れ、E2: 大量チャットメッセージ処理 |
| **非機能要件** | 処理時間5分以内、同時処理100ユーザー以上 |

### 2.2 UC-002: 返信案選択・確定

| 項目 | 内容 |
|------|------|
| **ユースケース名** | 返信案選択・確定 |
| **ユースケースID** | UC-002 |
| **優先度** | 高 |
| **アクター** | エンドユーザー |
| **前提条件** | 返信案が生成されている、ユーザーが通知を受け取っている |
| **事後条件** | 返信内容が確定される |
| **基本フロー** | 1. 通知確認 → 2. UIアクセス → 3. 返信案確認 → 4. 選択・編集 → 5. 確定 |
| **代替フロー** | A1: 返信案編集、A2: 返信キャンセル、A3: 再生成要求 |
| **例外処理** | E1: セッションタイムアウト、E2: ネットワークエラー |
| **非機能要件** | UI応答時間3秒以内、セッションタイムアウト30分 |

### 2.3 UC-003: Teamsチャット返信実行

| 項目 | 内容 |
|------|------|
| **ユースケース名** | Teamsチャット返信実行 |
| **ユースケースID** | UC-003 |
| **優先度** | 高 |
| **アクター** | エンドユーザー、MCPサーバー |
| **前提条件** | 返信内容が確定されている、MCPサーバーが利用可能 |
| **事後条件** | 返信メッセージが正常に送信される |
| **基本フロー** | 1. 返信内容送信 → 2. MCP経由送信 → 3. 結果確認 → 4. 完了通知 |
| **代替フロー** | A1: 送信失敗時の再送信、A2: 添付ファイル処理 |
| **例外処理** | E1: MCPサーバー障害、E2: 送信制限 |
| **非機能要件** | 送信処理時間2分以内、再送信機能 |

### 2.4 UC-004: システム設定管理

| 項目 | 内容 |
|------|------|
| **ユースケース名** | システム設定管理 |
| **ユースケースID** | UC-004 |
| **優先度** | 中 |
| **アクター** | システム管理者 |
| **前提条件** | 管理者権限を持つアカウントでログインしている |
| **事後条件** | 設定が正常に更新される |
| **基本フロー** | 1. 設定画面アクセス → 2. 設定確認・変更 → 3. 保存 → 4. 有効性確認 |
| **代替フロー** | A1: 設定エラー時の修正 |
| **例外処理** | E1: 設定変更失敗時のロールバック |
| **非機能要件** | 設定反映時間1分以内、設定変更履歴保持 |

## 3. データフロー定義

### 3.1 チャットメッセージ情報データフロー

```
Microsoft Graph API → Webhook → Auto Chat Maker → MCPサーバー → データベース
```

**データ項目**:
- チャットメッセージID
- 送信者情報
- メッセージ内容
- 送信日時
- 添付ファイル情報
- スレッド情報
- メッセージタイプ（テキスト、画像、ファイル等）

### 3.2 返信案データフロー

```
AIサービス → Auto Chat Maker → データベース → UI → ユーザー
```

**データ項目**:
- 返信案ID
- 元チャットメッセージID
- 返信案内容
- 生成日時
- 優先度
- 選択状態

### 3.3 送信結果データフロー

```
MCPサーバー → Auto Chat Maker → データベース → ユーザー
```

**データ項目**:
- 送信ID
- 返信案ID
- 送信日時
- 送信結果
- エラー情報（該当時）

## 4. エラーハンドリング仕様

### 4.1 エラー分類

| エラーレベル | 説明 | 対応方法 |
|-------------|------|----------|
| **Critical** | システム停止レベルのエラー | 即座にアラート通知、自動復旧試行 |
| **Error** | 機能実行不可のエラー | エラーログ記録、ユーザーへの通知 |
| **Warning** | 機能低下のエラー | ログ記録、代替処理実行 |
| **Info** | 情報レベルのメッセージ | ログ記録のみ |

### 4.2 主要エラーケース

| エラーケース | エラーレベル | 対応処理 |
|-------------|-------------|----------|
| Webhookサブスクリプション期限切れ | Warning | 自動更新処理 |
| MCPサーバー接続失敗 | Error | 再試行処理、フォールバック |
| AIサービス応答なし | Error | 定型返信案生成 |
| データベース接続失敗 | Critical | システム停止、管理者通知 |
| チャットメッセージ送信失敗 | Error | 再送信処理、ユーザー通知 |

## 5. パフォーマンス要件

### 5.1 処理時間要件

| 処理項目 | 目標時間 | 最大許容時間 |
|----------|----------|-------------|
| チャットメッセージ検知から返信案生成 | 3分以内 | 5分以内 |
| 返信案選択UI表示 | 1秒以内 | 3秒以内 |
| チャットメッセージ送信処理 | 1分以内 | 2分以内 |
| システム設定反映 | 30秒以内 | 1分以内 |

### 5.2 同時処理要件

| 項目 | 要件値 |
|------|--------|
| 同時ユーザー数 | 100人以上 |
| 同時チャットメッセージ処理数 | 50件以上 |
| データベース接続数 | 20接続以上 |
| AIサービス同時リクエスト | 30リクエスト以上 |

## 6. セキュリティ要件

### 6.1 認証・認可

| 項目 | 要件 |
|------|------|
| ユーザー認証 | Microsoft 365認証必須 |
| 管理者認証 | 多要素認証推奨 |
| アクセス制御 | ロールベースアクセス制御 |
| セッション管理 | 30分タイムアウト |

### 6.2 データ保護

| 項目 | 要件 |
|------|------|
| チャットメッセージ内容暗号化 | TLS 1.3以上 |
| データベース暗号化 | 保存時暗号化必須 |
| ログ暗号化 | 機密情報マスキング |
| 監査ログ | 全操作ログ記録 |

## 7. 拡張性要件

### 7.1 将来的なメール対応

| 項目 | 要件 |
|------|------|
| 共通AI判定・生成ロジック | メールとチャットで再利用可能 |
| メッセージ処理インターフェース | プラグイン形式での拡張 |
| 統合UI | チャットとメールの統合管理 |
| データベース設計 | メッセージタイプによる拡張 |

### 7.2 プラグイン機能

| 項目 | 要件 |
|------|------|
| 新機能追加 | プラグイン形式での実装 |
| 設定管理 | 機能の有効/無効切り替え |
| バージョン管理 | プラグインの互換性確保 |

## 8. 更新履歴

| 日付 | バージョン | 変更内容 | 更新者 |
|------|-----------|----------|--------|
| 2024年12月 | 1.0 | 初版作成 | 開発チーム |
| 2024年12月 | 1.1 | Teams対応化、拡張性要件を追加 | 開発チーム |
