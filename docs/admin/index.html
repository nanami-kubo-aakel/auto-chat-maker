<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auto Chat Maker CMS</title>
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <!-- Netlify Identity Widget -->
  <div id="netlify-identity-widget"></div>

  <div id="nc-root">
    <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
      <h2>Auto Chat Maker CMS</h2>
      <p>CMSを読み込み中...</p>
    </div>
  </div>

  <!-- DeCap CMS - 動的読み込み -->
  <script>
    console.log('=== CMS Debug Information ===');
    console.log('Script loading started');

    // Netlify Identityの初期化
    if (window.netlifyIdentity) {
      console.log('Netlify Identity found, initializing...');
      window.netlifyIdentity.init();
    } else {
      console.error('Netlify Identity not found!');
    }

    // DeCap CMSスクリプトを動的に読み込み
    function loadDeCapCMS() {
      console.log('Loading DeCap CMS script...');

      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/decap-cms@3.8.4/dist/decap-cms.js';
      script.onload = function() {
        console.log('DeCap CMS script loaded successfully');
        console.log('window.CMS after load:', typeof window.CMS);
        console.log('window.decapCMS after load:', typeof window.decapCMS);
        console.log('window.netlifyCMS after load:', typeof window.netlifyCMS);

        // DeCap CMSは自動的に初期化されるため、手動初期化は不要
        // ただし、CMSオブジェクトが利用可能かチェック
        setTimeout(function() {
          console.log('Checking CMS availability after script load...');
          console.log('window.CMS:', typeof window.CMS);
          console.log('window.decapCMS:', typeof window.decapCMS);
          console.log('window.netlifyCMS:', typeof window.netlifyCMS);

          if (window.CMS || window.decapCMS || window.netlifyCMS) {
            console.log('CMS object is available - DeCap CMS should auto-initialize');
          } else {
            console.error('CMS object still not available after script load');
          }
        }, 100);
      };
      script.onerror = function() {
        console.error('Failed to load DeCap CMS script');
      };

      document.head.appendChild(script);
    }


    // DOMが完全に読み込まれた後に実行
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded');
      // DeCap CMSスクリプトを読み込み
      loadDeCapCMS();
    });
  </script>
</body>
</html>
