# アーキテクチャ設計書

## 概要

AIメールアシスタントシステムは、クリーンアーキテクチャ（Clean Architecture）に基づいて設計されています。

## アーキテクチャ理論

### クリーンアーキテクチャ（Clean Architecture）

Robert C. Martin（Uncle Bob）が提唱したアーキテクチャパターンを採用しています。

#### 特徴
- **依存関係の方向**: 内側（ドメイン）に向かって依存
- **レイヤー分離**: 関心事の分離による保守性向上
- **テスタビリティ**: 各レイヤーの独立したテストが可能
- **フレームワーク独立性**: ビジネスロジックがフレームワークに依存しない

#### レイヤー構成
```
Entities (ドメイン) ← Use Cases (アプリケーション) ← Interface Adapters (インフラ) ← Frameworks & Drivers (フレームワーク)
```

## ディレクトリ構造

```
src/auto_chat_maker/
├── __init__.py
├── api/                        # フレームワーク & ドライバー層
│   ├── __init__.py
│   ├── controllers/            # HTTPリクエスト処理
│   │   └── __init__.py
│   ├── middleware/             # 認証、ログ、エラーハンドリング
│   │   └── __init__.py
│   └── routes.py               # APIルーティング定義
│
├── application/                # アプリケーション層
│   ├── __init__.py
│   ├── use_cases/              # ユースケース（ビジネスプロセス）
│   │   └── __init__.py
│   └── schedulers/             # 定期実行処理
│       └── __init__.py
│
├── domain/                     # エンティティ層（ドメイン層）
│   ├── __init__.py
│   ├── models/                 # ドメインモデル（エンティティ）
│   │   └── __init__.py
│   ├── repositories/           # リポジトリインターフェース
│   │   └── __init__.py
│   └── value_objects/          # 値オブジェクト
│       └── __init__.py
│
├── infrastructure/             # インターフェースアダプター層
│   ├── __init__.py
│   ├── repositories/           # リポジトリ実装
│   │   └── __init__.py
│   ├── external/               # 外部サービス連携
│   │   └── __init__.py
│   └── database/               # データベース関連
│       └── __init__.py
│
├── services/                   # ドメインサービス層
│   └── __init__.py
│
├── utils/                      # ユーティリティ層
│   └── __init__.py
│
├── config/                     # 設定層
│   └── __init__.py
│
└── main.py                     # アプリケーションエントリーポイント
```

## レイヤー詳細

### 1. API層（Frameworks & Drivers）

**責任**: HTTPリクエストの受信とレスポンスの送信

**含まれるもの**:
- HTTPエンドポイント
- リクエスト/レスポンスの変換
- 認証・認可
- バリデーション

**依存関係**: アプリケーション層に依存

### 2. アプリケーション層（Use Cases）

**責任**: ビジネスプロセスの調整

**含まれるもの**:
- ユースケース（ビジネスプロセス）
- 定期実行処理
- ワークフロー制御

**依存関係**: ドメイン層に依存

### 3. ドメイン層（Entities）

**責任**: ビジネスルールとエンティティ

**含まれるもの**:
- ドメインモデル（エンティティ）
- 値オブジェクト
- ドメインサービス
- リポジトリインターフェース

**依存関係**: 他のレイヤーに依存しない

### 4. インフラストラクチャ層（Interface Adapters）

**責任**: 外部システムとの連携

**含まれるもの**:
- リポジトリ実装
- 外部APIクライアント
- データベース接続
- ファイルシステム操作

**依存関係**: ドメイン層に依存

### 5. サービス層（Domain Services）

**責任**: ドメインロジックの実装

**含まれるもの**:
- 複雑なビジネスロジック
- 複数のエンティティを跨ぐ処理

**依存関係**: ドメイン層に依存

### 6. ユーティリティ層

**責任**: 共通機能の提供

**含まれるもの**:
- ログ出力
- セキュリティ機能
- ヘルパー関数

**依存関係**: 他のレイヤーに依存しない

### 7. 設定層

**責任**: アプリケーション設定の管理

**含まれるもの**:
- 環境変数
- 設定ファイル
- 定数定義

**依存関係**: 他のレイヤーに依存しない

## 依存関係の方向

```
API → アプリケーション → ドメイン ← インフラストラクチャ
```

- 内側のレイヤーは外側のレイヤーに依存しない
- 外側のレイヤーは内側のレイヤーのインターフェースに依存
- 依存関係は内側に向かって流れる

## 設計原則

### 1. 依存性逆転の原則（Dependency Inversion Principle）
- 高レベルのモジュールは低レベルのモジュールに依存しない
- 両方とも抽象に依存する
- 抽象は詳細に依存しない

### 2. 単一責任の原則（Single Responsibility Principle）
- 各クラスは1つの責任を持つ
- 各レイヤーは明確な責任を持つ

### 3. 開放閉鎖の原則（Open-Closed Principle）
- 拡張に対して開いている
- 修正に対して閉じている

### 4. リスコフ置換の原則（Liskov Substitution Principle）
- サブタイプは基底タイプと置換可能

### 5. インターフェース分離の原則（Interface Segregation Principle）
- クライアントは使用しないインターフェースに依存しない

## 更新履歴

- 初版作成: 2024年12月
- 最終更新: 2024年12月
- 更新者: 開発チーム 